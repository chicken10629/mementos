<!-- 投稿詳細
タイトル、画像、エピソード
いいねぼたん
他のユーザーからのコメント一覧
コメント投稿機能
投稿一覧に戻る
-->
<div class="container py-5">
  <div class="red-border pt-3 mb-5 bg-white">
    <% if @post.image.attached? %>
      <%= image_tag @post.image, class: "d-block mr-auto ml-3", width: 300, height: 300, style: "object-fit: cover;" %>
      <!-- 画像のカラム名.variant(resize: "width x height")で表示するサイズを変更。image_processingを利用。 -->
    <% else %>
      <%= image_tag 'publicdomainq-0060457lwn.jpg', class: "d-block mr-auto ml-3", width: 300, height: 300 %>
    <% end %>
    <h4 class="pl-3 mt-3">
      <i class="fa-solid fa-quote-left"></i>
      <%= @post.title %>
    </h4>
    <p class="pl-3 mt-4">
      <i class="fa-solid fa-file-lines"></i>
      <%= @post.body %>
    <p>
    <% if current_user && @post.user_id == current_user.id %>
      <%= link_to "編集する", edit_post_path(@post), class: "btn btn-primary ml-3" %>
      <!-- 日本語より先にパスを書いたらURLが表示されてしまった。current_user&&にしないとゲスト時nilエラー -->
    <% end %>
    <!-- 別ユーザーの投稿に限りプロフィール表示 -->

    <% if current_user && @post.user_id != current_user.id %>
      <div class="row post_user mt-3">
        <% if @post.user.profile_image.attached? %>
          <p><%= image_tag @post.user.profile_image.variant(resize: "100x100") %></p>
        <% else %>
          <p><%= image_tag 'no_image.jpg', size: "100x100" %></p>
        <% end %>
        <p><%= link_to @post.user.name, user_path(@post.user_id) %></p>
      </div>
    <% end %>

    <!--非同期通信でいいねを実行する
    流れとしては
    remote: trueで非同期通信にする
    変えたいもののid"$()"を選択し、変えたいテキスト"html()"や値"val()"を入力する。それをjsで実行する
    
    -->
    <div class="favorite">
      <p class="pl-3" id="favorite_btn_<%= @post.id %>">
        <%= render "public/favorites/btn", post: @post %>
        <!-- publicから指定しないとなぜか読み込んでくれない。謎すぎる -->
      </p>
    </div>
  </div>
    <div class="post-comment blue-border bg-white py-3 pl-3">
      <h4 class="mb-3">
        <i class="fa-regular fa-comments"></i>
        みんなのコメント
      </h4>
      <% if current_user %>
        <%= form_with model: @post_comment, url: post_post_comments_path(@post) do |f| %>
        
          <%= f.label :comment, "コメントしよう" %><br>
          <%= f.text_area :comment %><br>
            <%= f.submit "投稿する" %>
        <% end %>
      <% else %>
          <p>ログインするとコメントができます。</p>
      <% end %>
    </div>
    <% if @post_comments.present? %>
      <div class="post-comment-list mt-5">
        <% @post_comments.each do |comment| %>
          <div class="black-border bg-white mt-3 p-3 ", style: "max-width: 500px;">
            <div class="post-user-profile">
              <% if comment.user.profile_image.attached? %>
                <%= image_tag comment.user.profile_image.variant(resize: "80x80"), style: "object-fit: cover;" %>
              <% else %>
                <%= image_tag "no_image.jpg", size: "80x80" %>
              <% end %>
              <p>
                <i class="fa-solid fa-user"></i>
                <%= comment.user.name %>
              <p>
            </div>
            <div>
              <i class="fa-solid fa-comment"></i>
              <%= comment.comment %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
</div>