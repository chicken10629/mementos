<div class="container py-5">
  <!-- ユーザー検索 -->

  <%= search_form_with @user_q, url: admin_search_index_path, method: :get do |f| %>
    <%= f.search_field :name_cont, placeholder: 'ユーザー名で検索' %>
    <%= f.submit 'ユーザー検索' %>
  <% end %>

  <%= search_form_with @post_q, url: admin_search_index_path, method: :get do |f| %>
    <%= f.search_field :title_cont, placeholder: '投稿名で検索' %>
    <%= f.search_field :body_cont, placeholder: '投稿文で検索' %>
    <%= f.submit 'ユーザー検索' %>
  <% end %>

<!-- 投稿の検索結果を表示
-->
  <% if @posts.present? %>
    <table class="table table-striped table-hover">
      <tr>
        <th>
        投稿画像
        </th>
        <th>
        タイトル
        </th>
        <th>
        エピソード
        </th>
        <th>
        登録日
        </th>
        <th>
        更新日
        </th>
        <th>
        投稿者アイコン
        </th>
        <th>
        投稿者
        </th>
        <th>
        編集
        </th>
      </tr>
      <% @posts.each do |post| %>
        <tr>
          <td>
            <% if post.image.attached? %>
              <%= image_tag post.image.representation(resize_to_fill: [80, 80]) %>
            <% else %>
              <%= image_tag 'publicdomainq-0060457lwn.jpg', size: "80x80" %>
            <% end %>
          </td>
          <td>
            <%= link_to post.title, admin_post_path(post.id) %>
          </td>
          <td>
          <!-- 念のため文字数制限 -->
            <%= post.body.to_s.truncate(20, omission: '...') %>
          </td>
          <td>
            <%= post.created_at.strftime("%Y/%m/%d %H:%M") %>
          </td>
          <td>
            <%= post.updated_at.strftime("%Y/%m/%d %H:%M") %>
          </td>
          <td>
            <% if post.user.profile_image.attached? %>
              <%= image_tag post.user.profile_image.representation(resize_to_fill: [80, 80]), style: "border-radius:40px;"  %>
            <% else %>
              <%= image_tag "no_image.jpg", size: "80x80", style:"border-radius:40px" %>
            <% end %>
          </td>
          <td>
            <%= link_to post.user.name, admin_user_path(post.user) %>
          </td>
          <td>
            <%= link_to "edit", edit_admin_post_path(post), class: "btn btn-primary" %>
            <%= link_to "delete", admin_post_path(post), class: "btn btn-danger", method: :delete, data: { confirm: "完全に削除します。よろしいですか？"} %>
          </td>
        </tr>
      <% end %>
    </table>
        <% end %>
  <% else %>
    <div style="min-height:50vh;">
      <p class="black-border bg-light w-50">
        検索結果はありませんでした。
      </p>
    </div>
  <% end %>

  <% if @users.present? %>
    <table class="table table-striped table-hover">
      <tr>
        <th>
          アイコン
        </th>
        <th>
          名前
        </th>
        <th>
          コメント
        </th>
        <th>
          メールアドレス
        </th>
        <th>
          登録日
        </th>
        <th>
          更新日
        </th>
        <th>
          公開状態
        </th>
        <th>
          アクティブ
        </th>
        <th>
          編集
        </th>
      </tr>
      <% @users.each do |user| %>
        <tr>
          <td>
            <% if user.profile_image.attached? %>
              <%= image_tag user.profile_image, size: "80x80", style: "object-fit: cover; border-radius:40px;" %>
            <% else %>
              <%= image_tag "no_image.jpg", size: "80x80", style: "border-radius: 40px;" %>
            <% end %>
          </td>
          <td>
            <%= link_to user.name, admin_user_path(user.id) %>
          </td>
          <td>
          <!-- 念のため文字数制限 入力ないときのエラー回避にto_s -->
            <%= user.introduction.to_s.truncate(20, omission: '...') %>
          </td>
          <td>
            <%= user.email %>
          </td>
          <td>
            <%= user.created_at.strftime("%Y/%m/%d %H:%M") %>
          </td>
          <td>
            <%= user.updated_at.strftime("%Y/%m/%d %H:%M") %>
          </td>
          <td>
            <% if user.is_public == true %>
            公開
            <% else %>
            非公開
            <% end %>
          </td>
          <td>
            <% if user.is_active == true %>
            アクティブ
            <% else %>
            アカウント削除済
            <% end %>
          </td>
          <td>
            <%= link_to "edit", edit_admin_user_path(user), class: "btn btn-primary" %>
            <%= link_to "delete", admin_user_path(user), class: "btn btn-danger", method: :delete, data: {confirm: "完全に削除します。よろしいですか？"} %>
          </td>
        </tr>
    <% end %>
    </table>
  <% else %>
    <div style="min-height:50vh;">
      <p class="black-border bg-light w-50">
        検索結果はありませんでした。
      </p>
    </div>
  <% end %>
</div>